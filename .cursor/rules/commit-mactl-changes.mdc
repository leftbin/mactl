---
description: Action rule to commit mactl changes with appropriate conventional commit messages
alwaysApply: false
---

# Rule: Commit Mactl Changes

## Purpose

When triggered, create a Git commit with an appropriate commit message following Conventional Commits format, based on the current conversation context and file changes.

## Rule Type

**Action Rule** - Executes git commit operations

## When to Use

- When user explicitly asks to commit changes
- After completing a feature or fix that's ready to be committed
- When wrapping up a development session

## Commit Message Format

Follow Conventional Commits format:

```
<type>(<scope>): <subject>

[optional body]

[optional footer]
```

### Types

Use these commit types:
- `feat`: New feature
- `fix`: Bug fix
- `refactor`: Code refactoring (no functional changes)
- `docs`: Documentation only changes
- `test`: Adding or updating tests
- `chore`: Build process, tooling, dependencies
- `perf`: Performance improvements
- `style`: Code style changes (formatting, no logic changes)
- `ci`: CI/CD changes
- `revert`: Reverting previous commits

### Scope

Determine scope from the affected files/components in the mactl repository:

#### Core Commands
- `cmd`: CLI commands and command handlers
- `cmd/root`: Root command implementation

#### Command Groups
- `cmd/app`: Application installation and management
- `cmd/bootstrap`: System bootstrap commands
- `cmd/bundle`: Bundle management
- `cmd/envvar`: Environment variable management
- `cmd/git`: Git configuration commands
- `cmd/keyboard`: Keyboard shortcut management
- `cmd/optimize`: System optimization commands
- `cmd/zshrc`: Zsh configuration management

#### Internal Packages
- `internal/app`: Application installers and configurations
- `internal/bootstrap`: Bootstrap logic
- `internal/bundle`: Bundle definitions
- `internal/cli`: CLI utilities
- `internal/envvar`: Environment variable utilities
- `internal/git`: Git configuration utilities
- `internal/installer`: Installation utilities (brew, mas, pip)
- `internal/keyboard`: Keyboard shortcut utilities
- `internal/lib`: Shared libraries
- `internal/optimize`: System optimization utilities
- `internal/zshrc`: Zsh configuration utilities

#### App Categories
- `app/audio`: Audio applications (krisp, shush)
- `app/browser`: Browser applications (chrome)
- `app/build`: Build tools (cloud, code, database, iac, kubernetes, network, scm, ux)
- `app/comm`: Communication applications (slack)
- `app/keyboard`: Keyboard utilities (karabiner, maestro, moom, rectangle)
- `app/mac`: macOS built-in applications
- `app/network`: Network tools (step, telnet)
- `app/tidy`: Menu bar and system tidy tools
- `app/tool`: Miscellaneous tools

#### Build & Tooling
- `build`: Build system and Makefile changes
- `deps`: Dependency updates
- `hack`: Scripts and utilities

#### Documentation
- `docs`: Documentation changes
- `readme`: README updates

#### Cross-cutting
- If multiple areas: Use broader scope or omit scope
- For repo-wide changes: Use `repo` or omit scope

### Subject

- Use imperative mood ("add" not "added" or "adds")
- No period at the end
- Keep under 72 characters
- Be specific but concise

### Body (Optional)

Add detailed body when:
- The change is complex and needs explanation
- Multiple related changes are included
- There are breaking changes
- Context would help future developers understand "why"

Body guidelines:
- Wrap at 72 characters
- Explain what and why, not how
- Use bullet points for multiple items
- Reference issues/tickets if applicable

### Footer (Optional)

Include footer for:
- `BREAKING CHANGE:` for breaking changes
- `Closes #123` or `Fixes #123` for issue references
- Co-authored-by for pair programming

## Execution Steps

1. **Analyze Changes**
   - Check `git status` to see modified files
   - Review the conversation context to understand what was changed
   - Identify the type and scope of changes

2. **Determine Commit Type and Scope**
   - Map file changes to appropriate type
   - Determine most relevant scope from file paths
   - Consider which part(s) of mactl are affected

3. **Craft Commit Message**
   - Write concise subject line (< 72 chars)
   - Decide if detailed body is needed based on:
     - Complexity of changes
     - Number of related changes
     - Need for future context
   - Add footer if there are breaking changes or issue references

4. **Create Commit**
   - Stage all changes with `git add -A`
   - Commit with the crafted message using `git commit -m "subject" [-m "body"]`
   - Use `-m` flag multiple times for subject + body, or use multiline format

## Examples

### Simple Feature Addition

```bash
git commit -m "feat(app/keyboard): add karabiner configuration support"
```

### Bug Fix with Context

```bash
git commit -m "fix(internal/git): resolve SSH key generation for newer OpenSSH versions" \
  -m "The key generation was failing with OpenSSH 8.8+ due to deprecated
key formats. This commit updates the command to use the modern format
and provides clear error messages when generation fails."
```

### Command Enhancement

```bash
git commit -m "feat(cmd/bootstrap): add dry-run flag to preview installation steps" \
  -m "Implement --dry-run flag to allow users to preview what would be
installed without actually making system changes. Useful for reviewing
bootstrap steps before execution."
```

### Refactoring with Multiple Files

```bash
git commit -m "refactor(internal/installer): extract brew installation to separate package" \
  -m "- Create dedicated brew installer package
- Add installation validation helpers
- Update bootstrap to use new installer
- Improve error handling and logging
- No functional changes to external behavior"
```

### Breaking Change

```bash
git commit -m "feat(cmd/app)!: change app configuration format to YAML" \
  -m "BREAKING CHANGE: App configuration format changed from JSON to YAML.

Existing app configs must be converted to YAML format.
Migration guide provided in docs/migration.md.

This change enables better readability and aligns with common
configuration file conventions."
```

### Documentation Update

```bash
git commit -m "docs(readme): add installation instructions for Homebrew"
```

### App Integration

```bash
git commit -m "feat(app/build): add support for Zed editor installation"
```

### Build System

```bash
git commit -m "chore(build): update build targets for Apple Silicon"
```

## Command Patterns

For simple commits:
```bash
git add -A && git commit -m "<type>(<scope>): <subject>"
```

For commits with body:
```bash
git add -A && git commit -m "<type>(<scope>): <subject>" -m "<body>"
```

For commits with multi-paragraph body:
```bash
git add -A
git commit -m "<type>(<scope>): <subject>" \
  -m "<paragraph 1>" \
  -m "" \
  -m "<paragraph 2>"
```

## Important Notes

- **Always run in mactl workspace**: `/Users/swarup/scm/github.com/leftbin/mactl`
- **Don't commit without reviewing**: Show the proposed commit message to the user before executing if the changes are significant
- **Stage selectively if needed**: If only some changes should be committed, stage specific files instead of `git add -A`
- **Don't skip hooks**: Never use `--no-verify` unless explicitly requested
- **Check for unstaged changes**: Review `git status` output to ensure all intended changes are staged

## Error Handling

If commit fails:
- Check if there are actually changes to commit
- Verify you're in the correct directory
- Check if a commit is already in progress (merge/rebase)
- Ensure commit message format is valid

## Workflow Integration

This rule works well with:
- `@generate-mactl-pr-info` - Generate PR info before creating pull request
- After completing a development task
- Before creating a pull request

## Execution

When this rule is triggered:

1. Navigate to mactl workspace
2. Run `git status` to check current changes
3. Analyze changes and conversation context
4. Propose commit message following the format above
5. Execute the commit command with appropriate permissions (git_write)
6. Confirm successful commit
